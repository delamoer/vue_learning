<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vue监视数据变化的原理</title>

    <script type="text/javascript" src="../js/vue.js"></script>
  </head>

  <body>
    <!--
      4.vue监视数据变化的原理：
        Vue.js 使用了一个响应式系统来监视数据的变化。当你在 Vue 实例中定义数据时，Vue 会使用 Object.defineProperty() 方法将这些数据属性转换为 getter 和 setter。这样，当数据被访问或修改时，Vue 能够检测到这些变化并触发相应的更新操作。
        具体来说，当你修改数据时，setter 会被调用，Vue 会将这个 变化记录下来，并通知所有依赖于该数据的组件进行重新渲染。这个过程通常被称为“依赖追踪”。
        Vue 还使用了一个称为“虚拟 DOM”的技术来优化更新过程。当数据变化时，Vue 会创建一个新的虚拟 DOM 树，并将其与旧的虚拟 DOM 树进行比较。通过这种方式，Vue 能够确定哪些部分的实际 DOM 需要更新，从而提高性能。
        需要注意的是，Vue 2.x 版本中对数组和对象的变化监视有一些限制，例如直接修改数组的索引或对象的属性不会被检测到。为了解决这个问题，Vue 提供了一些方法，如 Vue.set() 和 Vue.delete()，以及数组变异方法（如 push、pop、splice 等），以确保这些变化能够被正确地监视和响应。
        在 Vue 3.x 版本中，Vue 引入了 Proxy 对象来替代 Object.defineProperty()，从而更全面地监视数据的变化，包括对数组和对象的直接修改。
        综上所述，Vue 通过响应式系统、依赖追踪和虚拟 DOM 技术，实现了对数据变化的高效监视和响应。
      例子： 
        1、使用 Vue.set() 向响应式对象添加新属性
        2、使用 Vue.delete() 删除响应式对象的属性
        3、使用数组变异方法（如 push、pop）来修改响应式数组
      备注：
        通过这些方法修改数据时，Vue 能够正确地监视到变化并触发视图更新。
      参考资料：
        Vue.js 官方文档 - 响应式原理：https://vuejs.org/v2/guide/reactivity.html
        Vue.js 官方文档 - Vue.set 和 Vue.delete：https://vuejs.org/v2/api/#Vue-set
        Vue.js 官方文档 - 数组变异方法：https://vuejs.org/v2/guide/list.html#Array-Change-Methods 
      
      -->

    <div id="root">
      <h2>vue监视数据变化的原理</h2>
      <button @click="vueSet">使用Vue.set修改数据</button>
      <button @click="vueDelete">使用Vue.delete删除数据</button> 
      <button @click="vuePop">使用Vue.pop删除数组最后一个元素</button>
      <button @click="vuePush">使用Vue.push添加数组新元素</button>
      <ul>
        <li v-for="(person, index) in persons" :key="person.id">
          {{ person.name }} - {{ person.age }} - {{ person.sex }}
        </li>
      </ul>
      <!--vue监视数据变化的例子-->
    </div>
    <script type="text/javascript">
        Vue.config.productionTip = false; //阻止vue在启动时产生生产提示
        const v = new Vue({
          data: {
            searchText: "",
            sortType: "",
            persons: [
              { id: 1, name: "马冬梅", age: 18, sex: "女" },
              { id: 2, name: "周冬雨", age: 19, sex: "女" },
              { id: 3, name: "周杰伦", age: 20, sex: "男" },
              { id: 4, name: "温兆伦", age: 21, sex: "男" },
            ],
          },
          methods: {
            vueSet() {
              // vue.set 用于向响应式对象添加一个新的属性，确保新属性同样是响应式的，并且触发视图更新
              Vue.set(this.persons[0], "age", 25);
            },
            vueDelete() {
              // vue.delete 用于从响应式对象中删除一个属性，确保删除操作能够被 Vue 监视到，并触发视图更新
              Vue.delete(this.persons[0], "age");
            },
            vuePop() {
              // vue.pop 用于从响应式数组中删除最后一个元素，确保删除操作能够被 Vue 监视到，并触发视图更新
              this.persons.pop();
            },
            vuePush() {
              // vue.push 用于向响应式数组中添加一个新元素，确保添加操作能够被 Vue 监视到，并触发视图更新
              this.persons.push({ id: 5, name: "新成员", age: 22, sex: "男" });
            }
          },
          mounted() {
            //测试vue监视数据变化的原理
            console.log("修改前：", this.persons[0]);
            this.vueSet();
            console.log("使用Vue.set修改后：", this.persons[0]);
            this.vueDelete();
            console.log("使用Vue.delete删除后：", this.persons[0]);
            this.vuePop();
            console.log("使用Vue.pop删除后：", this.persons);
            this.vuePush();
            console.log("使用Vue.push添加后：", this.persons);
        }
        });
        v.$mount("#root");
    </script>
  </body>
</html>
